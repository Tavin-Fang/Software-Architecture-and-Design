{% extends "base.html" %}

{% block content %}
<div class="container mt-5">
    <h3 class="text-center">租借设备管理</h3>

    <!-- 当前已借出设备 -->
    <h4 class="mt-4">当前已借出设备</h4>
 <hr>
    {% if borrowed_devices %}
        <table class="table table-striped table-bordered mt-3">
            <thead>
                <tr>
                    <th>设备编号</th>
                    <th>设备名称</th>
                    <th>实验室</th>
                    <th>租借时间</th>
                    <th>借用人</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody>
                {% for record in borrowed_devices %}
                    <tr>
                        <td>{{ record.device.device_id }}</td>
                        <td>{{ record.device.name }}</td>
                        <td>{{ record.device.lab }}</td>
                        <td>{{ record.borrow_time.strftime('%Y-%m-%d %H:%M:%S') }}</td>
                        <td>{{ record.user.username }}</td>
                        <td>
                            <form action="{{ url_for('send_return_reminder1', user_id=record.user.id, device_id=record.device.id) }}" method="post">
                                <button type="submit" class="btn btn-info btn-sm">发送提醒</button>
                            </form>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p class="text-center mt-4">当前没有已借出的设备。</p>
    {% endif %}

    <!-- 用户租借历史记录 -->
 <hr>
    <h4 class="mt-5">用户租借历史记录</h4>
 <hr>
    {% if all_borrow_records %}
        <table class="table table-striped table-bordered mt-3">
            <thead>
                <tr>
                    <th>设备编号</th>
                    <th>设备名称</th>
                    <th>实验室</th>
                    <th>租借时间</th>
                    <th>归还时间</th>
                    <th>借用人</th>
                </tr>
            </thead>
            <tbody>
                {% for record in all_borrow_records %}
                    <tr>
                        <td>{{ record.device.device_id }}</td>
                        <td>{{ record.device.name }}</td>
                        <td>{{ record.device.lab }}</td>
                        <td>{{ record.borrow_time.strftime('%Y-%m-%d %H:%M:%S') }}</td>
                        <td>{{ record.return_time.strftime('%Y-%m-%d %H:%M:%S') if record.return_time else '未归还' }}</td>
                        <td>{{ record.user.username }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p class="text-center mt-4">暂无租借历史记录。</p>
    {% endif %}

    <!-- 返回首页按钮 -->
    <div class="text-center mt-3">
        <a href="{{ url_for('index') }}" class="btn btn-secondary">返回首页</a>
    </div>
</div>
{% endblock %}
